{% extends 'bins/base.html' %}

{% block title %}Settings - Smart Waste Management{% endblock %}

{% block content %}
<div class="page-header">
  <h2>⚙️ Settings</h2>
  <p>Configure your system preferences and application settings</p>
</div>

<form method="post" class="settings-form">
  {% csrf_token %}
  
  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }}">
        {{ message }}
      </div>
    {% endfor %}
  {% endif %}

<div class="settings-grid">
  <div class="settings-section">
    <h3>🔔 Notification Settings</h3>
    
    <div class="setting-item">
        <div class="setting-info">
          <h4>📧 Email Notifications</h4>
          <p>Receive email alerts for important system events</p>
        </div>
        <div class="setting-control">
          <label class="toggle-switch">
            <input type="checkbox" name="email_notifications" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>🚨 Critical Alerts</h4>
          <p>Get immediate notifications for critical bin conditions</p>
        </div>
        <div class="setting-control">
          <label class="toggle-switch">
            <input type="checkbox" name="critical_alerts" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>📊 Daily Reports</h4>
          <p>Receive daily summary reports via email</p>
        </div>
        <div class="setting-control">
          <label class="toggle-switch">
            <input type="checkbox" name="daily_reports">
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
      
      <div class="setting-item">
        <div class="setting-info">
          <h4>📱 Browser Notifications</h4>
          <p>Show browser notifications for real-time updates</p>
        </div>
        <div class="setting-control">
          <label class="toggle-switch">
            <input type="checkbox" name="browser_notifications" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
  </div>
  
  <div class="settings-section">
    <h3>🎨 Display Preferences</h3>
    
    <div class="setting-item">
      <div class="setting-info">
        <h4>🌙 Theme</h4>
        <p>Choose your preferred visual theme</p>
      </div>
      <div class="setting-control">
        <select class="setting-select" name="theme">
          <option value="light" selected>Light Theme</option>
          <option value="dark">Dark Theme</option>
          <option value="auto">Auto (System)</option>
        </select>
      </div>
    </div>
    
    <div class="setting-item">
      <div class="setting-info">
        <h4>📏 Density</h4>
        <p>Adjust the information density of the interface</p>
      </div>
      <div class="setting-control">
        <div class="radio-group">
          <label class="radio-option">
            <input type="radio" name="density" value="compact">
            <span>Compact</span>
          </label>
          <label class="radio-option">
            <input type="radio" name="density" value="normal" checked>
            <span>Normal</span>
          </label>
          <label class="radio-option">
            <input type="radio" name="density" value="comfortable">
            <span>Comfortable</span>
          </label>
        </div>
      </div>
    </div>
    
    <div class="setting-item">
      <div class="setting-info">
        <h4>⏱️ Auto-refresh Interval</h4>
        <p>How often to automatically update dashboard data</p>
      </div>
      <div class="setting-control">
        <select class="setting-select" name="refresh_interval">
          <option value="5">5 seconds</option>
          <option value="8" selected>8 seconds</option>
          <option value="15">15 seconds</option>
          <option value="30">30 seconds</option>
          <option value="60">1 minute</option>
          <option value="0">Disabled</option>
        </select>
      </div>
    </div>
  </div>
  
  <div class="settings-section">
    <h3>🤖 AI & Analytics</h3>
    
    <div class="setting-item">
      <div class="setting-info">
        <h4>📈 Model Training</h4>
        <p>Automatically retrain AI models with new data</p>
      </div>
      <div class="setting-control">
        <label class="toggle-switch">
          <input type="checkbox" name="auto_training" checked>
          <span class="toggle-slider"></span>
        </label>
      </div>
    </div>
    
    <div class="setting-item">
      <div class="setting-info">
        <h4>⚡ Route Optimization</h4>
        <p>Default alpha value for route optimization algorithm</p>
      </div>
      <div class="setting-control">
        <div class="range-control">
          <input type="range" min="0" max="2" step="0.1" value="0.5" class="range-input" id="default-alpha">
          <span class="range-value">0.5</span>
        </div>
      </div>
    </div>
    
    <div class="setting-item">
      <div class="setting-info">
        <h4>🎯 Prediction Accuracy</h4>
        <p>Minimum accuracy threshold for AI predictions</p>
      </div>
      <div class="setting-control">
        <div class="range-control">
          <input type="range" min="0.5" max="1" step="0.05" value="0.85" class="range-input" id="accuracy-threshold">
          <span class="range-value">85%</span>
        </div>
      </div>
    </div>
    
    <div class="ai-actions">
      <button type="button" class="btn-primary" onclick="trainModel()">
        🧠 Train Model Now
      </button>
      <button type="button" class="btn-secondary" onclick="resetModel()">
        🔄 Reset to Default
      </button>
    </div>
  </div>
  
  <div class="settings-section">
    <h3>💾 Data Management</h3>
    
    <div class="setting-item">
      <div class="setting-info">
        <h4>🗄️ Data Retention</h4>
        <p>How long to keep historical sensor data</p>
      </div>
      <div class="setting-control">
        <select class="setting-select" name="data_retention">
          <option value="30">30 days</option>
          <option value="90" selected>90 days</option>
          <option value="180">6 months</option>
          <option value="365">1 year</option>
          <option value="0">Forever</option>
        </select>
      </div>
    </div>
    
    <div class="setting-item">
      <div class="setting-info">
        <h4>📤 Auto Backup</h4>
        <p>Automatically backup data and configurations</p>
      </div>
      <div class="setting-control">
        <label class="toggle-switch">
          <input type="checkbox" name="auto_backup" checked>
          <span class="toggle-slider"></span>
        </label>
      </div>
    </div>
    
    <div class="data-actions">
      <button type="button" class="btn-primary" onclick="exportData()">
        📁 Export Data
      </button>
      <button type="button" class="btn-secondary" onclick="importData()">
        📥 Import Data
      </button>
      <button type="button" class="btn-warning" onclick="clearOldData()">
        🗑️ Clear Old Data
      </button>
    </div>
  </div>
  
  <div class="settings-section">
    <h3>🔧 System Settings</h3>
    
    <div class="setting-item">
      <div class="setting-info">
        <h4>🛡️ Security Mode</h4>
        <p>Enhanced security features and monitoring</p>
      </div>
      <div class="setting-control">
        <label class="toggle-switch">
          <input type="checkbox" name="security_mode" checked>
          <span class="toggle-slider"></span>
        </label>
      </div>
    </div>
    
    <div class="setting-item">
      <div class="setting-info">
        <h4>📋 Debug Logging</h4>
        <p>Enable detailed logging for troubleshooting</p>
      </div>
      <div class="setting-control">
        <label class="toggle-switch">
          <input type="checkbox" name="debug_logging">
          <span class="toggle-slider"></span>
        </label>
      </div>
    </div>
    
    <div class="setting-item">
      <div class="setting-info">
        <h4>🌐 API Rate Limiting</h4>
        <p>Maximum API requests per minute</p>
      </div>
      <div class="setting-control">
        <input type="number" class="setting-input" value="100" min="10" max="1000" name="api_rate_limit">
      </div>
    </div>
    
    <div class="system-info">
      <h4>📊 System Information</h4>
      <div class="info-grid">
        <div class="info-item">
          <span class="info-label">Version:</span>
          <span class="info-value">v2.1.0</span>
        </div>
        <div class="info-item">
          <span class="info-label">Database:</span>
          <span class="info-value">MySQL 8.0</span>
        </div>
        <div class="info-item">
          <span class="info-label">Python:</span>
          <span class="info-value">3.13</span>
        </div>
        <div class="info-item">
          <span class="info-label">Django:</span>
          <span class="info-value">4.2</span>
        </div>
      </div>
    </div>
  </div>
  
  <div class="settings-section">
    <h3>🔄 Advanced Options</h3>
    
    <div class="setting-item">
      <div class="setting-info">
        <h4>⚠️ Maintenance Mode</h4>
        <p>Put the system in maintenance mode for updates</p>
      </div>
      <div class="setting-control">
        <button type="button" class="btn-warning" onclick="toggleMaintenance()">
          🔧 Enable Maintenance
        </button>
      </div>
    </div>
    
    <div class="setting-item">
      <div class="setting-info">
        <h4>🧹 Cache Management</h4>
        <p>Clear application cache and temporary data</p>
      </div>
      <div class="setting-control">
        <button type="button" class="btn-secondary" onclick="clearCache()">
          🗑️ Clear Cache
        </button>
      </div>
    </div>
    
    <div class="setting-item">
      <div class="setting-info">
        <h4>🔄 Factory Reset</h4>
        <p>Reset all settings to factory defaults</p>
      </div>
      <div class="setting-control">
        <button type="button" class="btn-danger" onclick="factoryReset()">
          ⚠️ Factory Reset
        </button>
      </div>
    </div>
  </div>
</div>

</form>

<div class="settings-footer">
  <div class="form-actions">
    <button type="submit" class="btn-primary btn-large">
      💾 Save All Settings
    </button>
    <button type="button" class="btn-secondary" onclick="resetForm()">
      🔄 Reset Changes
    </button>
  </div>
</div>

<script>
// Range input handlers
document.getElementById('default-alpha').addEventListener('input', function() {
  this.nextElementSibling.textContent = this.value;
});

document.getElementById('accuracy-threshold').addEventListener('input', function() {
  this.nextElementSibling.textContent = Math.round(this.value * 100) + '%';
});

// Settings actions
function trainModel() {
  if (confirm('Training the AI model may take several minutes. Continue?')) {
    // Implementation would call training API
    alert('Model training started. You will be notified when complete.');
  }
}

function resetModel() {
  if (confirm('Reset AI model to factory defaults? This cannot be undone.')) {
    // Implementation would reset model
    alert('Model reset to factory defaults.');
  }
}

function exportData() {
  // Implementation would trigger data export
  alert('Data export started. Download will begin shortly.');
}

function importData() {
  // Implementation would open file picker for import
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = '.json,.csv,.backup';
  input.click();
}

function clearOldData() {
  if (confirm('Delete all data older than retention period? This cannot be undone.')) {
    // Implementation would clear old data
    alert('Old data cleanup started.');
  }
}

function toggleMaintenance() {
  if (confirm('Enable maintenance mode? Users will be unable to access the system.')) {
    // Implementation would enable maintenance mode
    alert('Maintenance mode enabled. Remember to disable it when done.');
  }
}

function clearCache() {
  if (confirm('Clear all cached data? This may temporarily slow down the system.')) {
    // Implementation would clear cache
    alert('Cache cleared successfully.');
  }
}

function factoryReset() {
  const confirmation = prompt('Type "RESET" to confirm factory reset:');
  if (confirmation === 'RESET') {
    alert('Factory reset initiated. The system will restart shortly.');
  }
}

function resetForm() {
  if (confirm('Reset all changes to last saved values?')) {
    location.reload();
  }
}
</script>
{% endblock %}